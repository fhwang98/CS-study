# 📕 Chapter 04 CPU의 작동 원리

## ✅ 04-1 ALU와 제어장치

### 📌 ALU

- `ALU` : 계산을 하는 부품
- 계산을 위해 `연산`과 `피연산자`가 필요
- 연산 결과는 숫자나 문자, 주소가 될 수도 있음
- 연산 결과는 메모리가 아닌 레지스터에 저장
  - CPU가 메모리에 접근하는 속도 > 레지스터에 접근하는 속도

<blockQuote>ALU가 받아들이는 정보</blockQuote>

- 레지스터 ➡️ ALU : 피연산자
- 제어장치 ➡️ ALU : 제어신호(수행할 연산)

<blockQuote>ALU가 내보내는 정보</blockQuote>

- ALU ➡️ 레지스터 : 연산의 결괏값
- ALU ➡️ 플래그 레지스터 : 플래그
  - 연산 결과에 대한 추가적인 정보를 플래그로 내보냄
  - 부호 플래그, 제로 플래그, 캐리 플래그, 오버플로우 플래그, 인터럽트 플래그

### 📌 제어장치

- `제어장치` : 제어신호를 내보내고, 명령어를 해석하는 부품
- `제어신호` : 컴퓨터 부품들을 작동시키기 위한 전기 신호

<blockQuote>제어장치가 받아들이는 정보</blockQuote>

- `클럭` : 컴퓨터의 부품이 움직이는 시간 단위
- 명령어 레지스터 ➡️ 제어장치 : 명령어
- 플러그 레지스터 ➡️ 제어장치 : 플러그
- CPU 외부 ➡️ 시스템 버스(제어 버스) ➡️ 제어 장치 : 제어 신호

<blockQuote>제어장치가 내보내는 정보</blockQuote>

- CPU 외부로 전달하는 제어신호
  - 제어장치 ➡️ 시스템 버스(제어 버스) ➡️ 메모리
  - 제어장치 ➡️ 시스템 버스(제어 버스) ➡️ 입출력장치
- CPU 내부로 전달하는 제어신호
  - 제어장치 ➡️ ALU : 수행할 연산 지시
  - 제어장치 ➡️ 레지스터 : 레지스터 간 데이터 이동 또는 레지스터에 저장된 명령어 해석

## ✅ 04-2 레지스터

### 📌 반드시 알아야 할 레지스터

- [프로그램 카운터](#-프로그램-카운터)
- [명령어 레지스터](#-명령어-레지스터)
- [메모리 주소 레지스터](#-메모리-주소-레지스터)
- [메모리 버퍼 레지스터](#-메모리-버퍼-레지스터)
- [플래그 레지스터](#-플래그-레지스터)
- [범용 레지스터](#-범용-레지스터)
- [스택 포인터](#-스택-포인터)
- [베이스 레지스터](#-베이스-레지스터)

### 🔍 프로그램 카운터

- 메모리에서 읽어들일 명령어의 주소 저장
- `명령어 포인터` 라고도 함
- 일반적으로 꾸준히 증가하며 프로그램을 차례로 실행
- 특정 메모리 주소로 실행 흐름을 이동하는 명령어가 실행되면 변경된 주소가 저장됨
- 인터럽트가 발생해도 실행 흐름이 끊어짐
- 주소 지정 방식에 사용됨
- 변위 주소 지정 방식에 사용

### 🔍 명령어 레지스터

- 메모리에서 읽어들인 명령어를 저장
- 명령어 레지스터 속 명령어 → 제어장치 → 제어신호

### 🔍 메모리 주소 레지스터

- 메모리의 주소를 저장
- CPU가 읽고자 하는 주소 값을 주소 버스로 보낼 때 거침

### 🔍 메모리 버퍼 레지스터

- 메모리와 주고 받을 값(명령어, 데이타)를 저장
- 메모리에 쓰고 싶은 값이나 메모리로부터 전달받은 값
- 데이터 버스로 주고 받을 값이 거침
- `메모리 데이터 레지스터` 라고도 함

### 🔍 플래그 레지스터

- ALU 연산 결과에 따른 플ㄹ래그 저장
- 연산 결과 또는 CPU 상태에 대한 부가적인 정보 저장

### 🔍 범용 레지스터

- 다양하고 일반적인 상황에서 자유롭게 사용
- 데이터와 주소 모두 저장 가능

### 🔍 스택 포인터

- 스택 주소 지정 방식에 사용됨

### 🔍 베이스 레지스터

- 변위 주소 지정 방식에 사용됨

### 📌 특정 레지스터를 이용한 주소 지정 방식

레지스터를 사용하는 명령어의 주소 지정 방식

### 🔍 스택 주소 지정 방식

- 스택과 스택 포인터를 이용
- `스택`: 한쪽 끝이 막혀있는 통과 같은 저장 공간, 가장 최근 저장 값부터 꺼냄
- **`스택 포인터`** : 스택의 꼭대기를 가리킴, 스택에 마지막으로 저장한 값의 위치를 저장하는 레지스터
- `스택 영역` : 메모리 안에 스택처럼 사용하도록 정해진 영역

### 🔍 변위 주소 지정 방식

- **오퍼랜드 필드의 값**(변위)와 **특정 레지스터의 값을 더하여** 유효 주소를 얻어내는 방식
- `연산코드` + `레지스터 필드` + `오퍼랜드 필드`
- 어떤 레지스터를 더하는지에 따라 `상대 주소 지정 방식`, `베이스 레지스터 주소 지정 방식` 등

<blockQuote>상대 주소 지정 방식</blockQuote>

- 오퍼랜드와 프로그램 카운터의 값을 더하여 유효주소를 얻는 방식
- 모든 코드를 실행하는 것이 아닌, 분기하여 특정 주소의 코드를 실행할 때 사용

<blockQuote>베이스 레지스터 주소 지정 방식</blockQuote>

- 오퍼랜드와 베이스 레지스터의 값을 더하여 유효주소를 얻는 방식
- `베이스 레지스터` = 기준 주소 역할
- `오퍼랜드` = 기준 주소로부터 떨어진 거리로서 역할
- 기준 주소로부터 얼마나 떨어져있는 주소에 접근할 것인지를 연산

## ✅ 04-3 명령어 사이클과 인터럽트

`명령어 사이클` : CPU가 명령어를 처리하는 정형화된 흐름
<br>
`인터럽트` : 흐름이 끊어지는 상황

### 📌 명령어 사이클

- 하나의 명령어가 처리되는 주기
- `인출 사이클` : 메모리에 있는 명령어를 CPU로 가져오는 단계
- `실행 사이클` : CPU로 가져온 명령어를 실행하는 단계
- `간접 사이클` : 명령어를 인출해 가져왔지만, 간접 주소 지정 방식과 같이 한번 더 메모리에 접근해야하는 경우
- `인터럽트`

### 📌 인터럽트

- CPU의 작업을 방해하는 신호
- [동기 인터럽트](#-동기-인터럽트)
- [비동기 인터럽트](#-비동기-인터럽트)

### 🔍 동기 인터럽트

- CPU에 의해 발생
- 프로그래밍 오류와 같은 **예외적인 상황**에 마주쳤을때 발생
- 동기 인터럽트보다는 **`예외`** 라 지칭

### 🔍 비동기 인터럽트

- 주로 입출력 장치에 의해 발생
- `하드웨어 인터럽트` 라고도 함
- CPU가 입출력 작업 중에도 효율적으로 명령어를 처리할 수 있게 함

<blockQuote>하드웨어 인터럽트 처리 순서</blockQuote>

1. 입출력장치가 CPU에 인터럽트 **`인터럽트 요청 신호`** 보냄
2. CPU는 실행 사이클이 끝나고 명령어를 인출하기 전 항상 인터럽트 여부 확인
3. CPU는 인터럽트 요청을 확인하고 **`인터럽트 플래그`** 를 통해 현재 인터럽트를 받아들일 수 있는지 여부 확인
4. 인터럽트를 받아들일 수 있다면 CPU는 지금까지의 작업을 백업
5. CPU는 **`인터럽트 벡터`** 를 참조하여 **`인터럽트 서비스 루틴`** 을 실행
6. 인터럽트 서비스 루틴 실행이 끝나면 4에서 백업한 작업을 복구하여 실행 재개

<blockQuote>하드웨어 인터럽트 키워드</blockQuote>

- **`인터럽트 요청 신호`** : 끼어들어도 되는지 CPU에게 보내는 신호
- **`인터럽트 플래그`** : 하드웨어 인터럽트를 받아들일지 말지 결정하는 플래그
  - 모든 하드웨어 인터럽트를 플래그로 막을 수 있는 것은 아님
  - 정전이나 하드웨어 고장 등의 인터럽트 같이 우선순위가 높은 요청은 무시불가
- **`인터럽트 서비스 루틴`** / **`인터럽트 핸들러`** : 어떤 인터럽트가 발생했을 때 해당 인터럽트를 어떻게 처리하고 작동할지에 대한 정보로 이루어진 프로그램
- **`인터럽트 벡터`** : 인터럽트 서비스 루틴을 식별하기 위한 정보
  - 하드웨어 인터럽트 요청을 보낸 대상이 데이터 버스를 통해 인터럽트 벡터 보냄
  - 인터럽트 벡터를 통해 인터럽트 서비스 루틴의 시작 주소를 알아냄

<blockQuote><b>CPU가 인터럽트를 처리한다 = 인터럽트 서비스 루틴을 실행하고 본래 수행하던 작업으로 다시 되돌아온다</b></blockQuote>

- 인터럽트 서비스 루틴도 다른 프로그램과 마찬가지로 명령어와 데이터로 이루어짐
- 기존의 프로그램에서 필요한 내용을 스택 영역에 백업
- 인터럽트 서비스 루틴을 실행 한 후 스택에 저장한 값을 불러와 기존 프로그램 재개

### 🔖 예외의 종류

    인터럽트
    	- 동기 인터럽트(예외)
    		- 폴트
    		- 트랩
    		- 중단
    		- 소프트웨어 인터럽트
    	- 비동기 인터럽트(하드웨어 인터럽트)

- **`폴트`** : 예외처리 직후 **예외가 발생한 명령어부터** 실행 재개
- **`트랩`** : 예외처리 직후 예외가 발생한 명령어의 **다음 명령어부터** 실행 재개
  - `디버깅` : 프로그램 개발 중 발생한 문제를 진단하고 해결하기 위한 작업
- **`중단`** : CPU가 실행중인 프로그램을 강제로 중단시킬 수밖에 없는 심각한 오류를 발견했을 때 발생
- **`소프트웨어 인터럽트`** : 시스템 호출이 발생했을 때
